<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Título y tema de la aplicación -->
    <title>App Offline</title>
    <meta name="theme-color" content="#317EFB">

    <!-- Carga de Tailwind CSS para un diseño moderno -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Enlace al Manifest que define la PWA -->
    <link rel="manifest" href="manifest.json">

    <style>
        /* Pequeño estilo para el indicador de estado */
        #status-indicator {
            transition: all 0.5s ease-in-out;
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100 font-sans">

    <div class="container mx-auto mt-10 p-5 max-w-2xl text-center">
        
        <header class="mb-8">
            <h1 class="text-4xl md:text-5xl font-bold text-blue-600 dark:text-blue-400">Mi Aplicación Offline</h1>
            <p class="text-lg text-gray-600 dark:text-gray-300 mt-2">Esta aplicación funciona incluso sin conexión a internet.</p>
        </header>

        <main class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-8">
            <div id="status-indicator" class="p-4 mb-6 rounded-lg text-white font-semibold flex items-center justify-center space-x-2">
                <span id="status-icon"></span>
                <span id="status-text"></span>
            </div>
            
            <p class="mb-4">
                ¡Bienvenido! La primera vez que visitas esta página con conexión, se guardará en tu dispositivo.
            </p>
            <p>
                Para probarla, desconecta tu internet (o detén el servidor local) y recarga la página. ¡Verás que sigue funcionando!
            </p>
        </main>

        <footer class="mt-8 text-sm text-gray-500">
            <p>Puedes "Instalar" esta aplicación en tu escritorio o pantalla de inicio desde el menú del navegador.</p>
        </footer>

    </div>

    <script>
        // --- SCRIPT PRINCIPAL DE LA APP ---

        // 1. Registrar el Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('Service Worker registrado con éxito:', registration);
                    })
                    .catch(error => {
                        console.log('Fallo en el registro del Service Worker:', error);
                    });
            });
        }

        // 2. Lógica para actualizar el indicador de estado (online/offline)
        const statusIndicator = document.getElementById('status-indicator');
        const statusText = document.getElementById('status-text');
        const statusIcon = document.getElementById('status-icon');

        function updateOnlineStatus() {
            const isOnline = navigator.onLine;
            
            statusText.textContent = isOnline ? 'Estás Conectado' : 'Estás Desconectado';
            
            if (isOnline) {
                statusIndicator.classList.remove('bg-red-500');
                statusIndicator.classList.add('bg-green-500');
                statusIcon.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.111 16.404a5.5 5.5 0 017.778 0M12 20h.01m-7.08-7.071a10 10 0 0114.142 0M1.394 9.393a15 15 0 0121.212 0" />
                    </svg>
                `;
            } else {
                statusIndicator.classList.remove('bg-green-500');
                statusIndicator.classList.add('bg-red-500');
                statusIcon.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                         <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 5.636a9 9 0 010 12.728m-12.728-12.728a9 9 0 0112.728 0M12 18.75a.75.75 0 100-1.5.75.75 0 000 1.5z" />
                    </svg>
                `;
            }
        }

        // Actualizar el estado al cargar la página y cuando cambie la conexión
        window.addEventListener('online', updateOnlineStatus);
        window.addEventListener('offline', updateOnlineStatus);
        updateOnlineStatus();
    </script>
</body>
</html>
